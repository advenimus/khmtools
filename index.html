<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KHM Tools</title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <!-- Update Notification Banner (hidden by default) -->
      <div id="update-notification" class="update-notification hidden">
        <span id="update-message">An update is available!</span>
        <button id="update-button" class="update-button">Install Update</button>
        <button id="dismiss-update" class="dismiss-button">×</button>
      </div>
      <div class="logo-container">
        <!-- Clickable SVG Logo that links to GitHub repository -->
        <a href="#" id="logo-link" title="Visit GitHub Repository">
          <img src="assets/logo.svg" alt="KHM Tools Logo" class="logo">
        </a>
      </div>
      <div class="title-container">
        <h1>KHM Tools</h1>
        <p>A collection of useful tools for Kingdom Hall Media (KHM) assignments.</p>
      </div>
      <div class="app-settings-container">
        <button id="app-settings-btn" class="app-settings-button" aria-label="Application Settings">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
    </header>
    
    <div class="tools-container">
      <div class="tools-list">
        <h2>Available Tools</h2>
        <ul>
          <li>
            <button id="zoom-attendance-btn" class="tool-button">
              <span class="tool-name">Zoom Attendance Calculator</span>
              <p class="tool-description">Calculate total attendance from Zoom poll results</p>
            </button>
          </li>
          <li>
            <button id="start-zoom-btn" class="tool-button">
              <span class="tool-name">Start Zoom</span>
              <p class="tool-description">Launch Zoom application</p>
            </button>
          </li>
          <li>
            <button id="media-launcher-btn" class="tool-button">
              <span class="tool-name">Media Launcher</span>
              <p class="tool-description">Launch all media presentation tools for hosting</p>
            </button>
          </li>
          <!-- Additional tools will be added here -->
        </ul>
      </div>
      
      <div id="tool-content" class="tool-content">
        <!-- Tool content will be loaded here -->
        <div id="welcome-screen" class="welcome-screen">
          <h2>Welcome to KHM Tools</h2>
          <p>This program is collection of useful tools for Kingdom Hall Media (KHM) assignments that will make each role easier. Each included tool has a help button which explains its use in more detail. Click the settings icon at the top left for application settings.</p>
        </div>
        
        <!-- Zoom Attendance Calculator Tool -->
        <div id="zoom-attendance-calculator" class="tool-panel hidden">
          <div class="tool-header">
            <h2>Zoom Attendance Calculator</h2>
            <button id="help-button" class="help-button" aria-label="Help">?</button>
          </div>
          <div id="help-popup" class="help-popup hidden">
            <p>To use this calculator: <br>1. Set up a poll in Zoom with options labeled as "1", "2", "3", etc. (representing the number of people watching).<br>2. After the meeting, enter the number of responses for each poll option.<br>3. Enter the number of phone connections (each counted as 1 person).<br>4. Click "Calculate" to get the total attendance.</p>
            <button id="close-help" class="close-help">×</button>
          </div>
          <p class="tool-instructions">Enter the number of responses for each poll option, then scroll down and hit calculate:</p>
          
          <form id="attendance-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="option1">1 person:</label>
                <input type="number" id="option1" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option2">2 people:</label>
                <input type="number" id="option2" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option3">3 people:</label>
                <input type="number" id="option3" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option4">4 people:</label>
                <input type="number" id="option4" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option5">5 people:</label>
                <input type="number" id="option5" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option6">6 people:</label>
                <input type="number" id="option6" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option7">7 people:</label>
                <input type="number" id="option7" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option8">8 people:</label>
                <input type="number" id="option8" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option9">9 people:</label>
                <input type="number" id="option9" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="option10">10 people:</label>
                <input type="number" id="option10" min="0" value="0" class="number-input">
              </div>
              <div class="form-group">
                <label for="optionPhone">Phone connections:</label>
                <input type="number" id="optionPhone" min="0" value="0" class="number-input">
              </div>
            </div>

            <div class="calculate-container">
              <button type="submit" class="calculate-btn">Calculate</button>
              <br>
              <p class="hint-text">You can also press Enter to calculate</p>
            </div>
          </form>         
        </div>
        
        <!-- Result View -->
        <div id="result-view" class="result-view hidden">
          <div class="result-container">
            <h2>Total Attendance</h2>
            <div id="attendance-result" class="attendance-result">0</div>
          </div>
          <button id="back-button" class="back-button">← Back to Calculator</button>
          <button id="calculate-again-button" class="calculate-again-btn">Calculate Again</button>
        </div>
        
        <!-- Start Zoom Tool -->
        <div id="start-zoom" class="tool-panel hidden">
          <div class="tool-header">
            <h2>Start Zoom</h2>
          </div>
          <div class="zoom-content">
            <p class="tool-instructions">Click the button below to launch Zoom with your configured meeting:</p>
            <button id="launch-zoom-btn" class="launch-zoom-btn">Launch Zoom</button>
            <p id="zoom-status" class="zoom-status"></p>
            <p class="settings-hint">Configure meeting ID and Zoom path in Settings (⚙️ button at top right)</p>
          </div>
        </div>
        
        <!-- Media Launcher Tool -->
        <div id="media-launcher" class="tool-panel hidden">
          <div class="tool-header">
            <h2>Media Launcher</h2>
          </div>
          <div class="media-launcher-content">
            <p class="tool-instructions">Launch all your meeting media tools with one click:</p>
            
            <div class="launch-sequence">
              <ul class="launch-steps">
                <li id="custommsg-step"><span class="step-text">Custom message</span></li>
                <li id="obs-step"><span class="step-text">Launch OBS with virtual camera</span></li>
                <li id="media-manager-step"><span class="step-text">Launch Meeting Media Manager</span></li>
                <li id="zoom-step"><span class="step-text">Launch Zoom</span></li>
              </ul>
            </div>
            
            <button id="launch-media-btn" class="launch-media-btn">Start Meeting</button>
            <p class="settings-hint">Configure tools, meeting ID, and application paths in Settings (⚙️ button at top right)</p>
            
            <!-- Progress container (hidden by default) -->
            <div id="launch-progress-container" class="launch-progress-container hidden">
              <div class="progress-bar-container">
                <div id="launch-progress-bar" class="progress-bar"></div>
              </div>
              <p id="launch-status" class="launch-status">Preparing to launch...</p>
            </div>
            
            <!-- custommsg popup (hidden by default) -->
            <div id="custommsg-popup" class="custommsg-popup hidden">
              <div class="custommsg-popup-content">
                <h3>Custom Message</h3>
                <p>Your custom message will appear here.</p>
                <p></p>
                <div class="custommsg-popup-progress">
                  <div class="custommsg-popup-progress-bar"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Unified Settings Popup -->
  <div id="app-settings-popup" class="unified-settings-popup hidden">
    <div class="unified-settings-content">
      <div class="unified-settings-header">
        <h2>KHM Tools Settings</h2>
        <button id="close-app-settings" class="close-app-settings">×</button>
      </div>
      
      <div class="unified-settings-body">
        <!-- Settings Navigation -->
        <div class="settings-nav">
          <ul class="settings-nav-list">
            <li><button id="nav-general" class="settings-nav-btn active">General</button></li>
            <li><button id="nav-meetings" class="settings-nav-btn">Meeting Settings</button></li>
            <li><button id="nav-media-launcher" class="settings-nav-btn">Media Launcher</button></li>
            <li><button id="nav-zoom" class="settings-nav-btn">Zoom Tools</button></li>
            <li><button id="nav-paths" class="settings-nav-btn">Application Paths</button></li>
          </ul>
        </div>

        <!-- Settings Content Area -->
        <div class="settings-content">
          <!-- General Settings Panel -->
          <div id="general-settings" class="settings-panel active">
            <h3>General Application Settings</h3>
            
            <div class="settings-option">
              <div class="settings-group-title">Window Options</div>
              <div class="checkbox-wrapper">
                <input type="checkbox" id="always-maximize" name="always-maximize">
                <label for="always-maximize">Always Open Maximized</label>
              </div>
              <p class="settings-description">When enabled, the application will always open maximized to fill the screen.</p>
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="run-at-logon" name="run-at-logon">
                <label for="run-at-logon">Run at Logon</label>
              </div>
              <p class="settings-description">Automatically start KHM Tools when you log into your computer.</p>
            </div>
            
            <div class="settings-option">
              <div class="settings-group-title">Startup Options</div>
              <label for="default-tool">Default open to tool:</label>
              <select id="default-tool" name="default-tool" class="settings-select">
                <option value="welcome-screen">Welcome Screen</option>
                <option value="zoom-attendance-calculator">Zoom Attendance Calculator</option>
                <option value="start-zoom">Start Zoom</option>
                <option value="media-launcher">Media Launcher</option>
              </select>
              <p class="settings-description">Select which tool should automatically open when the application launches.</p>
            </div>
            
            <div class="settings-option">
              <div class="settings-group-title">Developer Options</div>
              <p class="settings-description">Toggle the Chrome DevTools for debugging and development.</p>
              <button id="toggle-dev-tools-btn" class="toggle-dev-tools-btn">Toggle Developer Tools</button>
              <p class="settings-hint">You can also use F12 or Cmd+Option+I</p>
            </div>
            
            <div class="settings-option reset-settings-option">
              <div class="settings-group-title">Reset Settings</div>
              <p class="settings-description">Reset all settings for all tools back to their default values.</p>
              <button id="reset-settings-btn" class="reset-settings-btn">Reset to Defaults</button>
              <div id="reset-confirmation" class="reset-confirmation hidden">Double-click to confirm reset</div>
            </div>
          </div>

          <!-- Meeting Settings Panel -->
          <div id="meeting-settings" class="settings-panel">
            <h3>Universal Meeting Settings</h3>
            
            <div class="settings-option">
              <div class="settings-group-title">Meeting Credentials</div>
              <div class="form-group">
                <label for="universal-meeting-id">Meeting ID:</label>
                <input type="text" id="universal-meeting-id" class="settings-input" placeholder="Enter your recurring meeting ID">
                <p class="settings-description">This meeting ID will be used by all Zoom tools in the application.</p>
              </div>
            </div>

            <div class="settings-option">
              <div class="settings-group-title">Meeting Schedule</div>
              
              <div class="form-group">
                <label for="midweek-day">Midweek Meeting:</label>
                <div class="meeting-time-row">
                  <select id="midweek-day" class="settings-select">
                    <option value="monday">Monday</option>
                    <option value="tuesday">Tuesday</option>
                    <option value="wednesday">Wednesday</option>
                    <option value="thursday">Thursday</option>
                    <option value="friday">Friday</option>
                  </select>
                  <span>at</span>
                  <input type="time" id="midweek-time" class="settings-input time-input" value="19:30">
                </div>
                <p class="settings-description">Set your midweek meeting day and time.</p>
              </div>
              
              <div class="form-group">
                <label for="weekend-day">Weekend Meeting:</label>
                <div class="meeting-time-row">
                  <select id="weekend-day" class="settings-select">
                    <option value="saturday">Saturday</option>
                    <option value="sunday">Sunday</option>
                  </select>
                  <span>at</span>
                  <input type="time" id="weekend-time" class="settings-input time-input" value="10:00">
                </div>
                <p class="settings-description">Set your weekend meeting day and time.</p>
              </div>
            </div>
          </div>

          <!-- Media Launcher Settings Panel -->
          <div id="media-launcher-settings" class="settings-panel">
            <h3>Media Launcher Settings</h3>
            
            <div class="settings-option">
              <div class="settings-group-title">Tool Selection</div>
              <p class="settings-description">Choose which tools to launch when you click "Start Meeting". At least one tool must be enabled.</p>
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="toggle-custom-message" name="toggle-custom-message">
                <label for="toggle-custom-message">Enable Custom Message</label>
              </div>
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="toggle-obs" name="toggle-obs">
                <label for="toggle-obs">Launch OBS Studio</label>
              </div>
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="toggle-media-manager" name="toggle-media-manager">
                <label for="toggle-media-manager">Launch Meeting Media Manager</label>
              </div>
              
              <div class="checkbox-wrapper">
                <input type="checkbox" id="toggle-zoom" name="toggle-zoom">
                <label for="toggle-zoom">Launch Zoom</label>
              </div>
            </div>

            <div class="settings-option">
              <div class="settings-group-title">Custom Message Settings</div>
              <p class="settings-description">Configure the message shown when Custom Message is enabled.</p>
              
              <div id="custom-message-settings" class="custom-message-settings">
                <div class="form-group">
                  <label for="custom-message-title">Title:</label>
                  <input type="text" id="custom-message-title" class="settings-input" placeholder="Enter custom title">
                </div>
                
                <div class="form-group">
                  <label for="custom-message-text">Message:</label>
                  <textarea id="custom-message-text" class="settings-textarea" placeholder="Enter custom message text"></textarea>
                </div>
                
                <div class="form-group">
                  <label for="custom-message-time">Display Time (seconds):</label>
                  <input type="number" id="custom-message-time" class="settings-input" min="1" max="30" value="5">
                </div>
              </div>
            </div>
          </div>

          <!-- Zoom Tools Settings Panel -->
          <div id="zoom-settings" class="settings-panel">
            <h3>Zoom Tools Settings</h3>
            <p class="settings-description">These settings apply to all Zoom-related tools. The Meeting ID is configured in the Meeting Settings section.</p>
            
            <div class="settings-option">
              <div class="settings-group-title">Zoom Attendance Calculator</div>
              <p class="settings-description">No additional settings required. This tool uses the universal meeting ID for its calculations.</p>
            </div>
          </div>

          <!-- Application Paths Settings Panel -->
          <div id="paths-settings" class="settings-panel">
            <h3>Application Paths</h3>
            <p class="settings-description">Configure the paths to your media applications (optional - uses defaults if not set):</p>
            
            <div class="form-group">
              <label>OBS Studio:</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <button id="browse-obs-path-btn" class="browse-btn">Browse</button>
                <p id="current-obs-path" class="current-path" style="margin: 0; flex: 1;">Using default path</p>
              </div>
            </div>
            
            <div class="form-group">
              <label>Meeting Media Manager:</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <button id="browse-media-manager-path-btn" class="browse-btn">Browse</button>
                <p id="current-media-manager-path" class="current-path" style="margin: 0; flex: 1;">Using default path</p>
              </div>
            </div>
            
            <div class="form-group">
              <label>Zoom Application:</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <button id="browse-zoom-path-btn" class="browse-btn">Browse</button>
                <p id="current-zoom-path" class="current-path" style="margin: 0; flex: 1;">Using default path</p>
              </div>
              <p class="settings-description">This Zoom application will be used by all Zoom tools (Media Launcher and Start Zoom).</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="unified-settings-footer">
        <p id="settings-status" class="settings-status"></p>
        <button id="save-unified-settings" class="save-app-settings">Save Settings</button>
      </div>
    </div>
  </div>
  
  
  <script src="renderer.js"></script>
</body>
</html>